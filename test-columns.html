<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ…ˆæ¿Ÿæ…ˆå–„äº‹æ¥­åŸºé‡‘æœƒ å¿—æ¥­åˆ†äº«</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&family=Noto+Serif+TC:wght@400;500;600;700&family=LXGW+WenKai+TC&display=swap" rel="stylesheet">
  <style>
    /* ===========================
       CSS Variables
       =========================== */
    :root {
      --color-primary: #5FCFC3;
      --color-primary-light: #7EDDD3;
      --color-secondary: #FFD700;
      --color-accent: #FF8C00;
      --color-text-primary: #FFFFFF;
      --color-text-secondary: #E8E8E8;
      --font-family-heading: "Noto Serif TC", serif;
      --font-family-body: "Noto Sans TC", sans-serif;
      --font-scale: 1;
      --left-panel-width: 100px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }

    body {
      font-family: var(--font-family-body);
      color: var(--color-text-primary);
      background: #1a1a2e;
    }

    /* ===========================
       ä¸»è¦ Flex å¸ƒå±€
       =========================== */
    .app-layout {
      display: flex;
      width: 100vw;
      height: 100vh;
      background-image: url('theme/default/background.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* ===========================
       å·¦å´é¢æ¿ï¼ˆæ¼¢å ¡ + é ç¢¼ï¼‰
       =========================== */
    .left-panel {
      width: var(--left-panel-width);
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 0;
      position: relative;
      z-index: 100;
    }

    .hamburger-btn {
      width: 50px;
      height: 50px;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 6px;
      padding: 0;
      margin-bottom: 30px;
    }

    .hamburger-btn:hover {
      background: rgba(0, 0, 0, 0.7);
    }

    .hamburger-btn span {
      display: block;
      width: 24px;
      height: 2px;
      background: white;
      border-radius: 2px;
    }

    .hamburger-btn.active span:nth-child(1) {
      transform: rotate(45deg) translate(6px, 6px);
    }

    .hamburger-btn.active span:nth-child(2) {
      opacity: 0;
    }

    .hamburger-btn.active span:nth-child(3) {
      transform: rotate(-45deg) translate(6px, -6px);
    }

    .page-indicator {
      writing-mode: vertical-rl;
      font-size: 48px;
      font-weight: bold;
      color: var(--color-secondary);
      font-family: var(--font-family-body);
      letter-spacing: 0.1em;
    }

    .page-indicator .current {
      font-size: 72px;
    }

    .page-indicator .separator {
      font-size: 32px;
      opacity: 0.6;
      margin: 10px 0;
    }

    .page-indicator .total {
      font-size: 36px;
      opacity: 0.8;
    }

    /* ===========================
       å…§å®¹å€ - Container Query
       =========================== */
    .content-area {
      flex: 1;
      overflow: hidden;
      position: relative;
      /* padding æ”¾åœ¨é€™è£¡ï¼Œcontainer åœ¨å…§å±¤ */
      padding: 60px 80px;
    }

    .manuscript-container {
      width: 100%;
      height: 100%;
      container-type: size;
      overflow: hidden;
    }

    .manuscript {
      width: 100cqw;
      height: 100cqh;
      column-width: 100cqw;
      column-gap: 0;
      column-fill: auto;

      /* é è¨­ç›´æ›¸ */
      writing-mode: vertical-rl;
      text-orientation: mixed;
    }

    /* æ©«æ›¸æ¨¡å¼ */
    body.horizontal-mode .manuscript {
      writing-mode: horizontal-tb;
    }

    body.horizontal-mode h1,
    body.horizontal-mode h2,
    body.horizontal-mode h3,
    body.horizontal-mode h4,
    body.horizontal-mode p,
    body.horizontal-mode li {
      writing-mode: horizontal-tb;
    }

    /* ===========================
       æ¨™é¡Œæ¨£å¼
       =========================== */
    h1, h2, h3, h4 {
      font-family: var(--font-family-heading);
      writing-mode: vertical-rl;
      text-orientation: mixed;
      letter-spacing: 0.15em;
      line-height: 1.6;
      margin: 0;
      break-after: avoid;
    }

    h1 {
      font-size: calc(clamp(48px, 8cqi, 100px) * var(--font-scale));
      color: var(--color-primary);
      font-weight: 700;
      margin-right: 1.5rem;
    }

    h2 {
      font-size: calc(clamp(42px, 7cqi, 90px) * var(--font-scale));
      color: var(--color-primary);
      font-weight: 600;
      break-before: column;
    }

    h3 {
      font-size: calc(clamp(36px, 6cqi, 80px) * var(--font-scale));
      color: var(--color-secondary);
      font-weight: 600;
    }

    h4 {
      font-size: calc(clamp(30px, 5cqi, 70px) * var(--font-scale));
      color: var(--color-primary-light);
    }

    /* ===========================
       æ®µè½
       =========================== */
    p {
      writing-mode: vertical-rl;
      text-orientation: mixed;
      font-size: calc(clamp(28px, 5cqi, 60px) * var(--font-scale));
      line-height: 1.8;
      letter-spacing: 0.1em;
      margin: 0 0.8rem;
      color: var(--color-text-primary);
    }

    /* ===========================
       åˆ—è¡¨
       =========================== */
    ul, ol {
      writing-mode: vertical-rl;
      list-style-position: inside;
      margin: 0 20px;
      padding: 0;
    }

    li {
      font-size: calc(clamp(28px, 5cqi, 60px) * var(--font-scale));
      line-height: 1.8;
      letter-spacing: 0.08em;
      margin-bottom: 0.8rem;
    }

    li::marker {
      color: var(--color-primary);
    }

    /* ===========================
       åœ–ç‰‡
       =========================== */
    img {
      display: block;
      max-width: 80%;
      max-height: 70cqh;
      width: auto;
      height: auto;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      margin: 20px auto;
      break-inside: avoid;
    }

    /* ===========================
       å°èˆªåˆ—ï¼ˆabsolute å®šä½ï¼‰
       =========================== */
    .slide-nav {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
      align-items: center;
      z-index: 200;
      background: rgba(0,0,0,0.5);
      padding: 15px 30px;
      border-radius: 50px;
    }

    .slide-nav.auto-hidden {
      opacity: 0.3;
    }

    .slide-nav:hover {
      opacity: 1;
    }

    .slide-nav button {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 12px 24px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 8px;
    }

    .slide-nav button:hover {
      background: rgba(255,255,255,0.4);
    }

    .slide-nav .page-info {
      color: white;
      font-size: 18px;
      min-width: 100px;
      text-align: center;
    }

    /* ===========================
       Sidebar è¨­å®šé¢æ¿
       =========================== */
    .sidebar {
      position: fixed;
      top: 0;
      left: -320px;
      width: 300px;
      height: 100vh;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(20px);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 10000;
      padding: 100px 20px 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    .sidebar.open {
      left: 0;
    }

    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
    }

    .sidebar-overlay.visible {
      opacity: 1;
      visibility: visible;
    }

    .settings-section {
      margin-bottom: 30px;
    }

    .settings-section h3 {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin: 0 0 15px 0;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      writing-mode: horizontal-tb;
    }

    .font-size-control {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .font-size-control button {
      width: 44px;
      height: 44px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }

    .font-size-control button:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .font-size-control .size-display {
      flex: 1;
      text-align: center;
      color: white;
      font-size: 16px;
    }

    .toggle-group {
      display: flex;
      gap: 10px;
    }

    .toggle-group button {
      flex: 1;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }

    .toggle-group button:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .toggle-group button.active {
      background: var(--color-primary);
      border-color: var(--color-primary);
    }

    .font-select {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .font-select button {
      padding: 12px 15px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      text-align: left;
    }

    .font-select button:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .font-select button.active {
      background: var(--color-primary);
      border-color: var(--color-primary);
    }

    .fullscreen-btn {
      width: 100%;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .fullscreen-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body>
  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Sidebar è¨­å®šé¢æ¿ -->
  <div class="sidebar" id="sidebar">
    <div class="settings-section">
      <h3>å­—é«”å¤§å°</h3>
      <div class="font-size-control">
        <button id="fontDecrease">A-</button>
        <span class="size-display" id="fontSizeDisplay">100%</span>
        <button id="fontIncrease">A+</button>
      </div>
    </div>
    <div class="settings-section">
      <h3>æ–‡å­—æ–¹å‘</h3>
      <div class="toggle-group">
        <button id="verticalBtn" class="active">ç›´æ›¸</button>
        <button id="horizontalBtn">æ©«æ›¸</button>
      </div>
    </div>
    <div class="settings-section">
      <h3>å­—é«”é¸æ“‡</h3>
      <div class="font-select">
        <button data-font="Noto Sans TC" class="active" style="font-family: 'Noto Sans TC', sans-serif;">Noto Sans TC</button>
        <button data-font="Noto Serif TC" style="font-family: 'Noto Serif TC', serif;">Noto Serif TC</button>
        <button data-font="LXGW WenKai TC" style="font-family: 'LXGW WenKai TC', cursive;">LXGW WenKai TC</button>
      </div>
    </div>
    <div class="settings-section">
      <button class="fullscreen-btn" id="fullscreenBtn">
        <span id="fullscreenIcon">â›¶</span>
        <span id="fullscreenText">å…¨è¢å¹•</span>
      </button>
    </div>
    <div class="settings-section">
      <button class="fullscreen-btn" id="toggleNavBtn">
        <span id="toggleNavIcon">ğŸ‘</span>
        <span id="toggleNavText">éš±è—å°èˆªåˆ—</span>
      </button>
    </div>
  </div>

  <!-- ä¸»è¦ Flex å¸ƒå±€ -->
  <div class="app-layout">
    <!-- å·¦å´é¢æ¿ -->
    <aside class="left-panel">
      <button class="hamburger-btn" id="hamburgerBtn">
        <span></span><span></span><span></span>
      </button>
      <div class="page-indicator">
        <span class="current" id="currentPage">1</span>
        <span class="separator">/</span>
        <span class="total" id="totalPages">?</span>
      </div>
    </aside>

    <!-- å…§å®¹å€ -->
    <main class="content-area" id="contentArea">
      <div class="manuscript-container" id="manuscriptContainer">
        <article class="manuscript" id="manuscript">
        <h1>äºŒã€‡äºŒå…­å¹´å…ƒæœˆäº”æ—¥</h1>
        <p>æ…ˆæ¿Ÿæ…ˆå–„äº‹æ¥­åŸºé‡‘æœƒ</p>
        <p>å¿—æ¥­åˆ†äº«</p>
        <p>å…±äº”é …è­°é¡Œ</p>
        <p>é€£ç·šæº–å‚™ä¸­è«‹ç¨å€™</p>

        <h2>ç¬¬ä¸€é …ï¼šæ…ˆå–„å¿—æ¥­</h2>
        <p>æ…ˆæ¿ŸåŸºé‡‘æœƒè‡ª1966å¹´æˆç«‹ä»¥ä¾†ï¼Œç§‰æŒã€Œç‚ºä½›æ•™ã€ç‚ºçœ¾ç”Ÿã€çš„ç†å¿µï¼Œè‡´åŠ›æ–¼æ…ˆå–„ã€é†«ç™‚ã€æ•™è‚²ã€äººæ–‡å››å¤§å¿—æ¥­ã€‚åœ¨å…¨çƒå„åœ°æ¨å‹•äººé“æ•‘æ´ã€è³‘ç½æ´åŠ©ã€ç¤¾å€é—œæ‡·ç­‰å·¥ä½œï¼Œè®“æ„›å¿ƒè·¨è¶Šåœ‹ç•Œã€ç¨®æ—ã€å®—æ•™çš„è—©ç±¬ã€‚</p>
        <p>æˆ‘å€‘ç›¸ä¿¡ï¼Œæ¯ä¸€å€‹å–„å¿µéƒ½èƒ½åŒ–ç‚ºå¯¦éš›çš„åŠ›é‡ï¼Œæ¯ä¸€æ¬¡ä»˜å‡ºéƒ½èƒ½ç‚ºä¸–ç•Œå¸¶ä¾†æ”¹è®Šã€‚é€éå¿—å·¥å€‘çš„ç„¡ç§å¥‰ç»ï¼Œæˆ‘å€‘æŒçºŒåœ¨ä¸–ç•Œå„å€‹è§’è½æ’­ä¸‹å¸Œæœ›çš„ç¨®å­ã€‚</p>
        <p>ä»Šå¹´åº¦æˆ‘å€‘åœ¨å…¨çƒæ•‘ç½è¡Œå‹•ä¸­ï¼Œæ´åŠ©äº†è¶…é50å€‹åœ‹å®¶ï¼Œå¹«åŠ©æ•¸ç™¾è¬å—ç½æ°‘çœ¾é‡å»ºå®¶åœ’ã€‚å¾åœ°éœ‡ã€æ°´ç½åˆ°æˆ°çˆ­é›£æ°‘ï¼Œæˆ‘å€‘å§‹çµ‚ç«™åœ¨ç¬¬ä¸€ç·šï¼Œç”¨æ„›å¿ƒæº«æš–æ¯ä¸€é¡†å—å‚·çš„å¿ƒéˆã€‚</p>

        <h2>ç¬¬äºŒé …ï¼šé†«ç™‚å¿—æ¥­</h2>
        <p>æ…ˆæ¿Ÿé†«ç™‚é«”ç³»ä»¥ã€Œäººæœ¬é†«ç™‚ã€å°Šé‡ç”Ÿå‘½ã€ç‚ºæ ¸å¿ƒåƒ¹å€¼ï¼Œåœ¨å°ç£è¨­æœ‰ä¸ƒå®¶é†«é™¢ï¼Œæä¾›é«˜å“è³ªçš„é†«ç™‚æœå‹™ã€‚æˆ‘å€‘ä¸åƒ…æ²»ç™‚ç–¾ç—…ï¼Œæ›´é—œæ‡·ç—…äººçš„èº«å¿ƒéˆå¥åº·ã€‚</p>
        <p>åœ‹éš›æ…ˆæ¿Ÿäººé†«æœƒçš„ç¾©è¨ºè¶³è·¡éåŠå…¨çƒï¼Œç‚ºåé åœ°å€çš„æ°‘çœ¾æä¾›å…è²»çš„é†«ç™‚æœå‹™ã€‚æ¯ä¸€ä½é†«è­·å¿—å·¥éƒ½å¸¶è‘—æ„Ÿæ©çš„å¿ƒï¼Œç”¨å°ˆæ¥­èˆ‡æ„›å¿ƒå®ˆè­·ç”Ÿå‘½ã€‚</p>
        <p>åœ¨ç–«æƒ…æœŸé–“ï¼Œæˆ‘å€‘çš„é†«ç™‚åœ˜éšŠæ›´æ˜¯ä¸çœ ä¸ä¼‘åœ°æŠ•å…¥é˜²ç–«å·¥ä½œï¼Œç‚ºç¤¾æœƒç¯‰èµ·å …å¯¦çš„å¥åº·é˜²ç·šã€‚é€™ä»½å …æŒèˆ‡ä»˜å‡ºï¼Œæ­£æ˜¯æ…ˆæ¿Ÿé†«ç™‚ç²¾ç¥çš„æœ€ä½³å±•ç¾ã€‚</p>

        <h2>ç¬¬ä¸‰é …ï¼šæ•™è‚²å¿—æ¥­</h2>
        <p>æ•™è‚²æ˜¯æ”¹è®Šç”Ÿå‘½çš„åŠ›é‡ã€‚æ…ˆæ¿Ÿæ•™è‚²é«”ç³»å¾å¹¼å…’åœ’åˆ°ç ”ç©¶æ‰€ï¼Œå®Œæ•´çš„æ•™è‚²ç¶²çµ¡åŸ¹è‚²ç„¡æ•¸å„ªç§€äººæ‰ã€‚æˆ‘å€‘æ³¨é‡å“å¾·æ•™è‚²ï¼ŒæœŸæœ›åŸ¹é¤Šå‡ºå…·æœ‰äººæ–‡ç´ é¤Šã€é—œæ‡·ç¤¾æœƒçš„æœªä¾†é ˜è¢–ã€‚</p>
        <p>åœ¨åé„‰æ•™è‚²æ–¹é¢ï¼Œæˆ‘å€‘æŒçºŒæ¨å‹•èª²è¼”è¨ˆç•«ã€çåŠ©å­¸é‡‘åˆ¶åº¦ï¼Œè®“æ¯ä¸€å€‹å­©å­éƒ½æœ‰å…¬å¹³çš„å—æ•™æ©Ÿæœƒã€‚å› ç‚ºæˆ‘å€‘ç›¸ä¿¡ï¼Œæ•™è‚²èƒ½ç¿»è½‰äººç”Ÿï¼ŒçŸ¥è­˜èƒ½æ”¹è®Šå‘½é‹ã€‚</p>

        <h2>ç¬¬å››é …ï¼šäººæ–‡å¿—æ¥­</h2>
        <p>å¤§æ„›é›»è¦–å°ã€æ…ˆæ¿ŸæœˆåˆŠã€ç¶“å…¸é›œèªŒç­‰åª’é«”å¹³å°ï¼Œå‚³æ’­æ­£å‘èƒ½é‡èˆ‡äººæ–‡é—œæ‡·ã€‚æˆ‘å€‘è¨˜éŒ„å–„çš„è¶³è·¡ï¼Œåˆ†äº«æ„Ÿäººçš„æ•…äº‹ï¼Œè®“æ›´å¤šäººçœ‹è¦‹ä¸–ç•Œçš„ç¾å¥½ã€‚</p>
        <p>éœæ€èªçš„æ™ºæ…§è©±èªï¼Œå•Ÿç™¼ç„¡æ•¸äººçš„å¿ƒéˆã€‚è­‰åš´ä¸Šäººçš„é–‹ç¤ºï¼Œå¼•å°æˆ‘å€‘åœ¨ç´›æ“¾çš„ä¸–ç•Œä¸­æ‰¾åˆ°å…§å¿ƒçš„å¹³éœèˆ‡æ–¹å‘ã€‚</p>

        <h2>ç¬¬äº”é …ï¼šç’°ä¿å¿—æ¥­</h2>
        <p>ç’°ä¿æ˜¯æ…ˆæ¿Ÿé‡è¦çš„ä½¿å‘½ä¹‹ä¸€ã€‚å¾1990å¹´è­‰åš´ä¸Šäººå‘¼ç±²ã€Œç”¨é¼“æŒçš„é›™æ‰‹åšç’°ä¿ã€é–‹å§‹ï¼Œå…¨å°ç£å·²è¨­ç«‹è¶…éå…«åƒå€‹ç’°ä¿ç«™ï¼Œåè¬å¤šä½ç’°ä¿å¿—å·¥æ¯å¤©å‹¤åšè³‡æºå›æ”¶ã€‚</p>
        <p>æˆ‘å€‘æ¨å»£ç´ é£Ÿã€æ¸›å¡‘ã€ç¯€èƒ½æ¸›ç¢³ç­‰ç’°ä¿ç”Ÿæ´»ï¼Œå¸Œæœ›æ¯å€‹äººéƒ½èƒ½å¾æ—¥å¸¸ç”Ÿæ´»åšèµ·ï¼Œç‚ºåœ°çƒç›¡ä¸€ä»½å¿ƒåŠ›ã€‚å› ç‚ºæˆ‘å€‘åªæœ‰ä¸€å€‹åœ°çƒï¼Œéœ€è¦å¤§å®¶å…±åŒå®ˆè­·ã€‚</p>
        <p>æ„Ÿæ©å¤§å®¶çš„åƒèˆ‡ï¼Œè®“æˆ‘å€‘ä¸€èµ·ç‚ºæ›´ç¾å¥½çš„ä¸–ç•ŒåŠªåŠ›ï¼</p>
        </article>
      </div>

      <!-- å°èˆªåˆ—ï¼ˆåœ¨ content-area å…§ï¼Œç”¨ absoluteï¼‰ -->
      <div class="slide-nav" id="slideNav">
        <button id="prevBtn">â—€ ä¸Šä¸€é </button>
        <span class="page-info"><span id="navCurrentPage">1</span> / <span id="navTotalPages">?</span></span>
        <button id="nextBtn">ä¸‹ä¸€é  â–¶</button>
      </div>
    </main>
  </div>

  <script>
    // ===========================
    // è®Šæ•¸èˆ‡å¸¸æ•¸
    // ===========================
    const FONT_SCALES = [0.8, 0.9, 1.0, 1.1, 1.2, 1.3];
    const STORAGE_KEYS = {
      fontSize: 'slides-font-size',
      orientation: 'slides-orientation',
      fontFamily: 'slides-font-family',
      navHidden: 'slides-nav-hidden'
    };

    const contentArea = document.getElementById('contentArea');
    const manuscriptContainer = document.getElementById('manuscriptContainer');
    const manuscript = document.getElementById('manuscript');
    const currentPageEl = document.getElementById('currentPage');
    const totalPagesEl = document.getElementById('totalPages');
    const navCurrentPageEl = document.getElementById('navCurrentPage');
    const navTotalPagesEl = document.getElementById('navTotalPages');
    const fontSizeDisplayEl = document.getElementById('fontSizeDisplay');
    const slideNav = document.getElementById('slideNav');

    let currentPage = 0;
    let totalPages = 1;
    let fontScale = 1;
    let navHideTimeout = null;
    let navPermanentlyHidden = false;

    // ===========================
    // åˆå§‹åŒ–
    // ===========================
    function init() {
      loadSettings();
      // ç­‰å¾… container è¨ˆç®—å®Œæˆ
      requestAnimationFrame(() => {
        updatePageCount();
        initEventListeners();
        resetNavHideTimer();
      });
    }

    // ===========================
    // è¼‰å…¥è¨­å®š
    // ===========================
    function loadSettings() {
      // å­—é«”å¤§å°
      const savedScale = localStorage.getItem(STORAGE_KEYS.fontSize);
      if (savedScale) {
        fontScale = parseFloat(savedScale);
        if (!FONT_SCALES.includes(fontScale)) fontScale = 1.0;
        setFontScale(fontScale, false);
      }

      // æ–‡å­—æ–¹å‘
      const savedOrientation = localStorage.getItem(STORAGE_KEYS.orientation);
      if (savedOrientation === 'horizontal') {
        document.body.classList.add('horizontal-mode');
        document.getElementById('horizontalBtn').classList.add('active');
        document.getElementById('verticalBtn').classList.remove('active');
      }

      // å­—é«”
      const savedFont = localStorage.getItem(STORAGE_KEYS.fontFamily);
      if (savedFont) {
        applyFont(savedFont, false);
        document.querySelectorAll('.font-select button').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.font === savedFont);
        });
      }

      // å°èˆªåˆ—
      const savedNavHidden = localStorage.getItem(STORAGE_KEYS.navHidden);
      if (savedNavHidden === 'true') {
        navPermanentlyHidden = true;
        slideNav.style.display = 'none';
        document.getElementById('toggleNavIcon').textContent = 'ğŸ‘â€ğŸ—¨';
        document.getElementById('toggleNavText').textContent = 'é¡¯ç¤ºå°èˆªåˆ—';
      }
    }

    // ===========================
    // é é¢è¨ˆç®—ï¼ˆä½¿ç”¨ container å°ºå¯¸ï¼‰
    // ===========================
    function isVerticalMode() {
      return !document.body.classList.contains('horizontal-mode');
    }

    function updatePageCount() {
      // ä½¿ç”¨ manuscriptContainerï¼ˆcontainerï¼‰çš„å¯¦éš›å°ºå¯¸
      const containerWidth = manuscriptContainer.clientWidth;
      const containerHeight = manuscriptContainer.clientHeight;

      if (isVerticalMode()) {
        // ç›´æ›¸æ¨¡å¼ï¼šå…§å®¹å‘ä¸‹å»¶ä¼¸ï¼Œç”¨ scrollHeight
        const scrollHeight = manuscript.scrollHeight;
        totalPages = Math.max(1, Math.ceil(scrollHeight / containerHeight));
      } else {
        // æ©«æ›¸æ¨¡å¼ï¼šå…§å®¹å‘å³å»¶ä¼¸ï¼Œç”¨ scrollWidth
        const scrollWidth = manuscript.scrollWidth;
        totalPages = Math.max(1, Math.ceil(scrollWidth / containerWidth));
      }

      // æ›´æ–°é¡¯ç¤º
      totalPagesEl.textContent = totalPages;
      navTotalPagesEl.textContent = totalPages;

      if (currentPage >= totalPages) {
        currentPage = totalPages - 1;
      }
      updatePageDisplay();

      console.log(`Mode: ${isVerticalMode() ? 'vertical' : 'horizontal'}, Container: ${containerWidth}x${containerHeight}, Pages: ${totalPages}`);
    }

    function updatePageDisplay() {
      const displayPage = currentPage + 1;
      currentPageEl.textContent = displayPage;
      navCurrentPageEl.textContent = displayPage;
    }

    // ===========================
    // ç¿»é 
    // ===========================
    function goToPage(page) {
      if (page < 0 || page >= totalPages) return;
      currentPage = page;

      const containerWidth = manuscriptContainer.clientWidth;
      const containerHeight = manuscriptContainer.clientHeight;

      if (isVerticalMode()) {
        manuscript.style.transform = `translateY(-${currentPage * containerHeight}px)`;
      } else {
        manuscript.style.transform = `translateX(-${currentPage * containerWidth}px)`;
      }
      updatePageDisplay();
    }

    function prevPage() {
      goToPage(currentPage - 1);
    }

    function nextPage() {
      goToPage(currentPage + 1);
    }

    // ===========================
    // å­—é«”å¤§å°
    // ===========================
    function setFontScale(scale, save = true) {
      fontScale = scale;
      document.documentElement.style.setProperty('--font-scale', scale);
      fontSizeDisplayEl.textContent = Math.round(scale * 100) + '%';
      if (save) {
        localStorage.setItem(STORAGE_KEYS.fontSize, scale.toString());
      }
      setTimeout(() => {
        updatePageCount();
        goToPage(Math.min(currentPage, totalPages - 1));
      }, 50);
    }

    function increaseFontSize() {
      const idx = FONT_SCALES.indexOf(fontScale);
      if (idx < FONT_SCALES.length - 1) {
        setFontScale(FONT_SCALES[idx + 1]);
      } else if (idx === -1) {
        const larger = FONT_SCALES.filter(s => s > fontScale);
        if (larger.length > 0) setFontScale(larger[0]);
      }
    }

    function decreaseFontSize() {
      const idx = FONT_SCALES.indexOf(fontScale);
      if (idx > 0) {
        setFontScale(FONT_SCALES[idx - 1]);
      } else if (idx === -1) {
        const smaller = FONT_SCALES.filter(s => s < fontScale);
        if (smaller.length > 0) setFontScale(smaller[smaller.length - 1]);
      }
    }

    // ===========================
    // å­—é«”é¸æ“‡
    // ===========================
    function applyFont(fontFamily, save = true) {
      document.body.style.fontFamily = `"${fontFamily}", sans-serif`;
      if (save) {
        localStorage.setItem(STORAGE_KEYS.fontFamily, fontFamily);
      }
    }

    // ===========================
    // æ–‡å­—æ–¹å‘
    // ===========================
    function setVerticalMode() {
      document.body.classList.remove('horizontal-mode');
      document.getElementById('verticalBtn').classList.add('active');
      document.getElementById('horizontalBtn').classList.remove('active');
      localStorage.setItem(STORAGE_KEYS.orientation, 'vertical');
      manuscript.style.transform = '';
      currentPage = 0;
      setTimeout(() => {
        updatePageCount();
        goToPage(0);
      }, 50);
    }

    function setHorizontalMode() {
      document.body.classList.add('horizontal-mode');
      document.getElementById('horizontalBtn').classList.add('active');
      document.getElementById('verticalBtn').classList.remove('active');
      localStorage.setItem(STORAGE_KEYS.orientation, 'horizontal');
      manuscript.style.transform = '';
      currentPage = 0;
      setTimeout(() => {
        updatePageCount();
        goToPage(0);
      }, 50);
    }

    // ===========================
    // Sidebar
    // ===========================
    function openSidebar() {
      document.getElementById('sidebar').classList.add('open');
      document.getElementById('sidebarOverlay').classList.add('visible');
      document.getElementById('hamburgerBtn').classList.add('active');
    }

    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('sidebarOverlay').classList.remove('visible');
      document.getElementById('hamburgerBtn').classList.remove('active');
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      if (sidebar.classList.contains('open')) {
        closeSidebar();
      } else {
        openSidebar();
      }
    }

    // ===========================
    // å…¨è¢å¹•
    // ===========================
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.log('ç„¡æ³•é€²å…¥å…¨è¢å¹•:', err);
        });
      } else {
        document.exitFullscreen();
      }
    }

    // ===========================
    // å°èˆªåˆ—é¡¯ç¤ºæ§åˆ¶
    // ===========================
    function showNav() {
      if (navPermanentlyHidden) return;
      slideNav.classList.remove('auto-hidden');
      resetNavHideTimer();
    }

    function hideNav() {
      slideNav.classList.add('auto-hidden');
    }

    function resetNavHideTimer() {
      if (navHideTimeout) clearTimeout(navHideTimeout);
      navHideTimeout = setTimeout(hideNav, 3000);
    }

    function toggleNavVisibility() {
      navPermanentlyHidden = !navPermanentlyHidden;
      if (navPermanentlyHidden) {
        slideNav.style.display = 'none';
        document.getElementById('toggleNavIcon').textContent = 'ğŸ‘â€ğŸ—¨';
        document.getElementById('toggleNavText').textContent = 'é¡¯ç¤ºå°èˆªåˆ—';
        localStorage.setItem(STORAGE_KEYS.navHidden, 'true');
      } else {
        slideNav.style.display = 'flex';
        document.getElementById('toggleNavIcon').textContent = 'ğŸ‘';
        document.getElementById('toggleNavText').textContent = 'éš±è—å°èˆªåˆ—';
        localStorage.setItem(STORAGE_KEYS.navHidden, 'false');
      }
    }

    // ===========================
    // äº‹ä»¶ç›£è½
    // ===========================
    function initEventListeners() {
      // ç¿»é æŒ‰éˆ•
      document.getElementById('prevBtn').onclick = prevPage;
      document.getElementById('nextBtn').onclick = nextPage;

      // æ¼¢å ¡é¸å–®
      document.getElementById('hamburgerBtn').onclick = toggleSidebar;
      document.getElementById('sidebarOverlay').onclick = closeSidebar;

      // å­—é«”å¤§å°
      document.getElementById('fontDecrease').onclick = decreaseFontSize;
      document.getElementById('fontIncrease').onclick = increaseFontSize;

      // æ–‡å­—æ–¹å‘
      document.getElementById('verticalBtn').onclick = setVerticalMode;
      document.getElementById('horizontalBtn').onclick = setHorizontalMode;

      // å­—é«”é¸æ“‡
      document.querySelectorAll('.font-select button').forEach(btn => {
        btn.onclick = function() {
          document.querySelectorAll('.font-select button').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          applyFont(this.dataset.font);
        };
      });

      // å…¨è¢å¹•
      document.getElementById('fullscreenBtn').onclick = toggleFullscreen;

      // å°èˆªåˆ—é¡¯ç¤ºåˆ‡æ›
      document.getElementById('toggleNavBtn').onclick = toggleNavVisibility;

      // éµç›¤æ§åˆ¶
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          const sidebar = document.getElementById('sidebar');
          if (sidebar.classList.contains('open')) {
            closeSidebar();
            return;
          }
        }
        showNav();
        switch(e.key) {
          case 'ArrowRight':
          case ' ':
          case 'PageDown':
            e.preventDefault();
            nextPage();
            break;
          case 'ArrowLeft':
          case 'PageUp':
            e.preventDefault();
            prevPage();
            break;
          case 'Home':
            e.preventDefault();
            goToPage(0);
            break;
          case 'End':
            e.preventDefault();
            goToPage(totalPages - 1);
            break;
        }
      });

      // æ»‘é¼ ç§»å‹•é¡¯ç¤ºå°èˆªåˆ—
      document.addEventListener('mousemove', showNav);

      // è¦–çª—å¤§å°æ”¹è®Š
      window.addEventListener('resize', () => {
        updatePageCount();
        goToPage(currentPage);
      });

      // è§¸æ§æ»‘å‹•
      let touchStartX = 0;
      let touchStartY = 0;
      document.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
        touchStartY = e.changedTouches[0].screenY;
      }, { passive: true });

      document.addEventListener('touchend', (e) => {
        const touchEndX = e.changedTouches[0].screenX;
        const touchEndY = e.changedTouches[0].screenY;
        const diffX = touchStartX - touchEndX;
        const diffY = touchStartY - touchEndY;

        // æ ¹æ“šæ¨¡å¼åˆ¤æ–·æ»‘å‹•æ–¹å‘
        if (isVerticalMode()) {
          // ç›´æ›¸æ¨¡å¼ï¼šä¸Šä¸‹æ»‘å‹•
          if (Math.abs(diffY) > 50 && Math.abs(diffY) > Math.abs(diffX)) {
            if (diffY > 0) nextPage();
            else prevPage();
          }
        } else {
          // æ©«æ›¸æ¨¡å¼ï¼šå·¦å³æ»‘å‹•
          if (Math.abs(diffX) > 50 && Math.abs(diffX) > Math.abs(diffY)) {
            if (diffX > 0) nextPage();
            else prevPage();
          }
        }
      }, { passive: true });
    }

    // å•Ÿå‹•
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
